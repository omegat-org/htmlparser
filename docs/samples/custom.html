<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Untitled Document</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</head>

<body>
<h2>Supporting Custom Tags (Extending the Parser) </h2>
<p>For your parsing application, it is quite possible that you may need to process 
  a tag that has not already been specially handled by the parser. By &quot;specially 
  handled&quot;, we mean coverage in the tag-scanner hierarchy. It is quite easy 
  for you to write your own tag-scanner pair, so as to give you the tags that 
  you want, the way you want it.</p>
<p><strong>What is a scanner ?</strong></p>
<p>A scanner is a class that works on a <strong>tag</strong>, and processes further 
  depending on the tag. e.g. a Link scanner will fire up when it receives &lt;A 
  ...&gt;. It will then read all tags until it finds &lt;/A&gt;. Then, it will 
  create a Link tag object, that contains all the html between the &lt;A ..&gt; 
  .. &lt;/A&gt; tags. </p>
<p><strong>Where does the scanner fit in ?</strong></p>
<p>HTMLParser is basically a collection of scanners, which can be configured to 
  produce a customized parser. You can choose which scanners you'd like to have 
  registered in the parser, so as to optimize your parsing. e.g. if all you're 
  interested in is image tags, you don't need to have all the scanners registered 
  - simply register HTMLImageScanner using the <em>addScanner() </em>method in 
  the HTMLParser class, like this :
  <!-- ======================================================== -->
  <!-- = Java Sourcecode to HTML automatically converted code = -->
  <!-- =   J2H V2.0  2002 by Markus Gebhard  markus@jave.de   = -->
  <!-- =     Further information: http://www.java2html.de     = -->
</p>
  <center>
 <table  align="center" border="2" cellpadding="3" cellspacing="0" bgcolor="#FFFBF0">
   <tr>
  <!-- start line numbers -->
   <td align="right" valign="top">
    <code>
     <font color="#808080">
1<br>
   </font>
    </code>
   </td>
  <!-- end line numbers -->
  <!-- start source code -->
   <td valign="top">
    <code>
<font color="#000000">parser.addScanner</font><font color="#000000">(</font><font color="#0000c0">new&nbsp;</font><font color="#000000">HTMLImageScanner</font><font color="#000000">(</font><font color="#990000">&#34;&#34;</font><font color="#000000">))</font><font color="#000000">;</font></code>
    
   </td>
  </tr>
  <!-- end source code -->
  <!-- start J2H link -->
   <tr>
    <td colspan=2 align=right>
<small>
<a href="http://www.java2html.de" target="_blank">Java2html</a>
</small>
    </td>
   </tr>
  <!-- end J2H link -->
 </table>
</center>
<!-- =       END of automatically generated HTML code       = -->
<!-- ======================================================== -->
<p><strong>Hmm.. so how does the parser integrate with the scanners ?</strong></p>
<p>The parser knows how to parse strings, comments and tags. When it encounters 
  any tag, it tries to identify the tag, by <strong>guessing a scanner </strong>that 
  might work on it (from a collection of registered scanners). The specific scanner 
  is asked to verify if it can indeed handle this tag, and if so, it is asked 
  to handle parsing from that point on, till the tag is completely parsed, and 
  then return control to the parser (by returning the specific tag object).</p>
<p><strong>Did you say &quot;guessing a scanner&quot; ?</strong></p>
<p>Yes. Each scanner provides an ID - which is also a partial string which is 
  used to make the guess. e.g. the ID of the link scanner is &quot;A &quot;, while 
  the ID of the image scanner is &quot;IMG &quot;. The parser has a hashtable 
  of scanners which are indexed on this ID. When a tag is encountered, the first 
  &quot;word&quot; is used as the key to this table, and if a scanner is found 
  for it, the parser has guessed that this scanner <strong>might </strong>be able 
  to handle the tag. </p>
<p>The parser then asks the scanner to verify that it can indeed handle the tag 
  by calling its <em>evaluate()</em> method. The evaluate method contains actual 
  logic to check the entire contents of the tag and make the match. If <em>evaluate() 
  </em>returns true, then the parser assumes that this scanner can handle this 
  tag. It then makes a call to the scanner's <em>scan() </em>method, asking it 
  to do any parsing necessary and return a tag object.</p>
<p><strong>Why do we need to call evaluate() ? Doesen't the guess always work 
  ?</strong></p>
<p>Well, yes. But, at times, more processing is needed within the scanner, especially 
  when tags are malformed. You might encounter &lt;A ...&gt; ... &lt;A&gt;. Note 
  that the ending tag is not &lt;/A&gt; but &lt;A&gt;. This is actually a valid 
  html page (Internet Explorer accepts it), and we would like to accept it too. 
  For that to happen, we'd like to write an intelligent <em>evaluate() </em>method 
  that knows that we're in the middle of parsing a link, and what we should be 
  getting is &lt;/A&gt; and not &lt;A&gt;. Hence, it is a false match, for a link 
  begin, however, we need to morph it to a &lt;/A&gt;. </p>
<p><strong>Hmm... This sounds complicated. What do I have to do to write a simple 
  scanner that operates on a single tag ?</strong></p>
<p>Don't worry, for simple tags, you don't need to implement evaluate(), it will 
  return true unless you override it. Lets extend the parser to enable it to identify 
  the &lt;BR&gt; tag. You'd need to create a tag-scanner pair like HTMLBRTag-HTMLBRScanner. 
  The code for HTMLBRScanner is shown below :
  <!-- ======================================================== -->
<!-- = Java Sourcecode to HTML automatically converted code = -->
<!-- =   J2H V2.0  2002 by Markus Gebhard  markus@jave.de   = -->
<!-- =     Further information: http://www.java2html.de     = -->
<center>
 <table  align="center" border="2" cellpadding="3" cellspacing="0" bgcolor="#FFFBF0">
   <tr>
  <!-- start line numbers -->
   <td width="16" align="right" valign="top">
    <code>
     <font color="#808080">
1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>
11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>
21<br>22<br>23<br>24<br>
   </font>
    </code>
   </td>
  <!-- end line numbers -->
  <!-- start source code -->
   <td width="992" valign="top">
    <code>
<font color="#0000c0">public&nbsp;class&nbsp;</font><font color="#000000">HTMLMetaTagScanner&nbsp;</font><font color="#0000c0">extends&nbsp;</font><font color="#000000">HTMLTagScanner&nbsp;</font><font color="#000000">{<br>
&nbsp;&nbsp;</font><font color="#0000c0">public&nbsp;</font><font color="#000000">HTMLMetaTagScanner</font><font color="#000000">(</font><font color="#000000">String&nbsp;filter</font><font color="#000000">)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000c0">super</font><font color="#000000">(</font><font color="#000000">filter</font><font color="#000000">)</font><font color="#000000">;<br>
&nbsp;&nbsp;</font><font color="#000000">}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;</font><font color="#0000c0">public&nbsp;</font><font color="#000000">HTMLTag&nbsp;scan</font><font color="#000000">(</font><font color="#000000">HTMLTag&nbsp;tag,String&nbsp;url,HTMLReader&nbsp;reader,&nbsp;String&nbsp;currLine</font><font color="#000000">)<br>
&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000c0">throws&nbsp;</font><font color="#000000">HTMLParserException&nbsp;</font><font color="#000000">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000c0">try&nbsp;</font><font color="#000000">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">HTMLBRTag&nbsp;brTag&nbsp;=&nbsp;</font><font color="#0000c0">new&nbsp;</font><font color="#000000">HTMLBRTag</font><font color="#000000">(</font><font color="#000000">tag.elementBegin</font><font color="#000000">()</font><font color="#000000">,tag.elementEnd</font><font color="#000000">()</font><font color="#000000">,tag.getText</font><font color="#000000">()</font><font color="#000000">,currLine</font><font color="#000000">)</font><font color="#000000">;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000c0">return&nbsp;</font><font color="#000000">brTag;<br>
&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}<br>
&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000c0">catch&nbsp;</font><font color="#000000">(</font><font color="#000000">Exception&nbsp;e</font><font color="#000000">)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000c0">throw&nbsp;new&nbsp;</font><font color="#000000">HTMLParserException</font><font color="#000000">(</font><font color="#990000">&#34;HTMLBRTagScanner.scan()&nbsp;:&nbsp;Error&nbsp;while&nbsp;scanning&nbsp;&lt;br&gt;&nbsp;tags,&nbsp;current&nbsp;line&nbsp;=&nbsp;&#34;</font><font color="#000000">+currLine,e</font><font color="#000000">)</font><font color="#000000">;<br>
&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">}<br>
&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;</font><font color="#0000c0">public&nbsp;</font><font color="#000000">String&nbsp;</font><font color="#000000">[]&nbsp;</font><font color="#000000">getID</font><font color="#000000">()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">String&nbsp;</font><font color="#000000">[]&nbsp;</font><font color="#000000">ids&nbsp;=&nbsp;</font><font color="#0000c0">new&nbsp;</font><font color="#000000">String</font><font color="#000000">[</font><font color="#990000">1</font><font color="#000000">]</font><font color="#000000">;<br>
&nbsp;&nbsp;&nbsp;&nbsp;ids</font><font color="#000000">[</font><font color="#990000">0</font><font color="#000000">]&nbsp;</font><font color="#000000">=&nbsp;</font><font color="#990000">&#34;BR&#34;</font><font color="#000000">;<br>
&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000c0">return&nbsp;</font><font color="#000000">ids;<br>
&nbsp;&nbsp;</font><font color="#000000">}<br>
<br>
}<br>
</font></code>
    
   </td>
  </tr>
  <!-- end source code -->
  <!-- start J2H link -->
   <tr>
    <td colspan=2 align=right>
<small>
<a href="http://www.java2html.de" target="_blank">Java2html</a>
</small>
    </td>
   </tr>
  <!-- end J2H link -->
 </table>
</center>
<!-- =       END of automatically generated HTML code       = -->
<!-- ======================================================== -->
<p><br>
  HTMLBRScanner is a subclass of HTMLTagScanner (as all scanners have to be). 
  It implements two methods from its parent class - scan() and getID(). The latter 
  method returns the token string which the scanner will be indexed on. This token 
  string is also used for matching a tag with this scanner. It must be upper-case 
  for the parser converts the first word in a tag to upper-case. </p>
<p><strong>Why does the getID() method return an array and not a single string 
  ? </strong></p>
<p>This is because a single scanner could handle different types of tags. e.g. 
  &lt;% ..&gt;, &lt;%= ..&gt;, &lt;%@ ..&gt;&quot; are all considered to be jsp 
  tags. We don't want a different scanner for each token, but would rather have 
  several tokens associated with a single scanner.</p>
<p><strong>Ok, so what does the scan method do here ?</strong></p>
<p>All it does is - create HTMLBRTag. This is because this is a very simple scanner. 
  It does not perform any further parsing (which it could as it does have the 
  reader object.</p>
<p><strong>How does the HTMLBRTag look like ?</strong></p>
<!-- ======================================================== -->
<!-- = Java Sourcecode to HTML automatically converted code = -->
<!-- =   J2H V2.0  2002 by Markus Gebhard  markus@jave.de   = -->
<!-- =     Further information: http://www.java2html.de     = -->
<center>
 <table  align="center" border="2" cellpadding="3" cellspacing="0" bgcolor="#FFFBF0">
   <tr>
  <!-- start line numbers -->
   <td align="right" valign="top">
    <code>
     <font color="#808080">
1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>
11<br>12<br>13<br>14<br>15<br>16<br>
   </font>
    </code>
   </td>
  <!-- end line numbers -->
  <!-- start source code -->
   <td valign="top">
    <code>
<font color="#0000c0">public&nbsp;class&nbsp;</font><font color="#000000">HTMLBRTag&nbsp;</font><font color="#0000c0">extends&nbsp;</font><font color="#000000">HTMLTag<br>
</font><font color="#000000">{<br>
&nbsp;&nbsp;</font><font color="#0000c0">public&nbsp;</font><font color="#000000">HTMLBRTag</font><font color="#000000">(</font><font color="#c00000">int&nbsp;</font><font color="#000000">elementBegin,&nbsp;</font><font color="#c00000">int&nbsp;</font><font color="#000000">elementEnd,String&nbsp;tagContents,String&nbsp;tagLine</font><font color="#000000">)<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000c0">super</font><font color="#000000">(</font><font color="#000000">elementBegin,elementEnd,tagContents,tagLine</font><font color="#000000">)</font><font color="#000000">;<br>
&nbsp;&nbsp;</font><font color="#000000">}<br>
<br>
&nbsp;&nbsp;</font><font color="#0000c0">public&nbsp;</font><font color="#000000">String&nbsp;toString</font><font color="#000000">()<br>
&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000c0">return&nbsp;</font><font color="#990000">&#34;BR&nbsp;TAG&nbsp;:&nbsp;begins&nbsp;at&nbsp;:&nbsp;&#34;</font><font color="#000000">+elementBegin</font><font color="#000000">()</font><font color="#000000">+</font><font color="#990000">&#34;;&nbsp;ends&nbsp;at&nbsp;:&nbsp;&#34;</font><font color="#000000">+elementEnd</font><font color="#000000">()</font><font color="#000000">;<br>
&nbsp;&nbsp;</font><font color="#000000">}<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;</font><font color="#0000c0">public&nbsp;</font><font color="#000000">String&nbsp;toHTML</font><font color="#000000">()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000c0">return&nbsp;</font><font color="#990000">&#34;&lt;BR&gt;&#34;<br>
&nbsp;&nbsp;</font><font color="#000000">}<br>
</font><font color="#000000">}</font></code>
    
   </td>
  </tr>
  <!-- end source code -->
  <!-- start J2H link -->
   <tr>
    <td colspan=2 align=right>
<small>
<a href="http://www.java2html.de" target="_blank">Java2html</a>
</small>
    </td>
   </tr>
  <!-- end J2H link -->
 </table>
</center>
<!-- =       END of automatically generated HTML code       = -->
<!-- ======================================================== -->
<p>HTMLBRTag is a subclass of HTMLTag, and implements its toHTML() and toString() 
  methods. The toHTML() returns an accurate representation of the tag. Actually, 
  it is <strong>not required </strong>for this example, as HTMLTag by default 
  constructs the tag with the default contents (wrapping the angle braces around 
  it). But sometimes, tags can have more information to offer, which need to be 
  formatted correctly. e.g. a link tag might need to iterate over its contents, 
  rendering each one.</p>
<p><strong>Ok, I've written by tag-scanner pair. Now what ? </strong></p>
<p>Register your scanner in the parser with a call to <em>parser.addScanner()</em>. 
  Once you've done this, just parse the way you normally do, and if you encounter 
  any BR tags, they will come up as HTMLBRTag objects. </p>
  <!-- ======================================================== -->
<!-- = Java Sourcecode to HTML automatically converted code = -->
<!-- =   J2H V2.0  2002 by Markus Gebhard  markus@jave.de   = -->
<!-- =     Further information: http://www.java2html.de     = -->
<center>
 <table  align="center" border="2" cellpadding="3" cellspacing="0" bgcolor="#FFFBF0">
   <tr>
  <!-- start line numbers -->
   <td align="right" valign="top">
    <code>
     <font color="#808080">
1<br>2<br>3<br>4<br>5<br>6<br>7<br>
   </font>
    </code>
   </td>
  <!-- end line numbers -->
  <!-- start source code -->
   <td valign="top">
    <code>
<font color="#000000">HTMLNode&nbsp;node;<br>
</font><font color="#0000c0">for&nbsp;</font><font color="#000000">(</font><font color="#000000">HTMLEnumeration&nbsp;e&nbsp;=&nbsp;parser.elements</font><font color="#000000">()</font><font color="#000000">;e.hasMoreNode</font><font color="#000000">()</font><font color="#000000">;</font><font color="#000000">)&nbsp;{<br>
&nbsp;&nbsp;</font><font color="#000000">node&nbsp;=&nbsp;e.nextHTMLNode</font><font color="#000000">()</font><font color="#000000">;<br>
&nbsp;&nbsp;</font><font color="#0000c0">if&nbsp;</font><font color="#000000">(</font><font color="#000000">node&nbsp;</font><font color="#0000c0">instanceof&nbsp;</font><font color="#000000">HTMLBRTag</font><font color="#000000">)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#008000">//&nbsp;We&nbsp;just&nbsp;got&nbsp;our&nbsp;tag!<br>
&nbsp;&nbsp;</font><font color="#000000">}<br>
</font><font color="#000000">}</font></code>
    
   </td>
  </tr>
  <!-- end source code -->
  <!-- start J2H link -->
   <tr>
    <td colspan=2 align=right>
<small>
<a href="http://www.java2html.de" target="_blank">Java2html</a>
</small>
    </td>
   </tr>
  <!-- end J2H link -->
 </table>
</center>
<!-- =       END of automatically generated HTML code       = -->
<!-- ======================================================== -->
<p>The above code shows you how. You're well on your way to writing scanners of 
  your own.</p>
<p><strong>Let them come...</strong></p>
<p>Now that you are ready to face complex scanners, the best grounding you can 
  get is by looking at actual code. Take a look at the code of HTMLMetaTagScanner, 
  HTMLTitleScanner, HTMLAppletScanner and finally HTMLLinkScanner. The latter 
  is fairly complex, so keep that as the last on your list.</p>
<p><strong>How about some tips for the scan() method ?</strong></p>
<p>There are a lot of handy methods that you might need when you are writing the 
  scan() method. Here are a few :</p>
<table width="94%" border="1">
  <tr> 
    <td width="15%">Attributes of the tag</td>
    <td width="85%"><p><font face="Courier New, Courier, mono">Hashtable table 
        = tag.getParsed(); <br>
        String attribute = (String)table.get(someAttributeName);</font></p>
      <p><font face="Courier New, Courier, mono"><strong>OR</strong></font></p>
      <p><font face="Courier New, Courier, mono">String attribute = tag.getParameter(someAttributeName);</font></p></td>
  </tr>
  <tr> 
    <td>Read all the tags till we encounter an end tag of the same type</td>
    <td><p><font face="Courier New, Courier, mono">boolean endFlag = false;<br>
        HTMLNode node;<br>
        do {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;node = reader.readElement();<br>
        &nbsp;&nbsp;&nbsp;&nbsp;//..<br>
        &nbsp;&nbsp;&nbsp;&nbsp;if (node instanceof HTMLEndTag) {<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;HTMLEndTag endTag = (HTMLEndTag)node;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if (endTag.getText().equals(someText)) endFlag=true;<br>
        &nbsp;&nbsp;&nbsp;&nbsp;}<br>
        }<br>
        while (!endFlag &amp;&amp; node!=null);</font></p>
      </td>
  </tr>
  <tr>
    <td>Read tags which follow an XML format</td>
    <td><font face="Courier New, Courier, mono">String data;<br>
      if (isXmlTagFound(tag,someTextToMatch)) data = extractXMLData(tag,someTextToMatch,reader);</font></td>
  </tr>
</table>
<p><a href="index.html">Back to Samples</a><br>
  <a href="../index.html">Back to HTMLParser Home Page</a></p>
</body>
</html>
