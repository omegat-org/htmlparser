<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>Untitled Document</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</head>

<body>
<h2><strong>Test-Driven Development</strong></h2>
<p>Test-Driven development is a rewarding practice, that stands out in eXtreme 
  Programming. All the other practices of XP can usually be compromised when dealing 
  with distributed teams, but the one practice that can and must be followed always 
  - is test-driven development (TDD).</p>
<p><strong>What is Test-Driven Development ?</strong></p>
<p>Test Coverage is a philosophy - that for every bit of logic in the system, 
  there is a test validating that the logic is correctly implemented (Unit Tests), 
  or that the logic is correct at all from an external system perspective (Functional 
  Tests). The HTMLParser project also follows quick releases - and in order to 
  ensure that a new release does not add more bugs, we ensure that -</p>
<p>[1] No existing tests break<br>
  [2] The new code has test-coverage</p>
<p>However, Test-Driven Development (TDD) is not about writing tests for your 
  code - it is writing tests <strong>before </strong>your code.<br>
  The reason we do this - is to keep the system as simple as possible, and just 
  write enough code to make the tests pass. After all the architecture and patterns 
  we study, it is dangerous if we cannot control our knowledge and use it indiscriminately. 
  TDD allows tests to drive the coding process, thus helping us produce a really 
  simple system. It is possibly a paradigm shift for many programmers who write 
  tests after the code, or don't write tests at all. But you cannot produce maintainable 
  systems of high quality without <strong>discipline</strong>. Hence, we really 
  like to enforce discipline on contributions to this project.</p>
<p><strong>I am sold on tests - now what ?</strong></p>
<p>Its time to take a look at the test-framework in place that enables quick and 
  easy testing - as we believe that testing should be painless. If it is too hard, 
  we wouldnt do it. To begin with, as is the case with most Java XP projects of 
  the day, we use <a href="http://www.junit.org">JUnit</a>. JUnit allows us to 
  create suites of tests and run them automatically. In case you are new to unit 
  testing, please make sure that you have read and tried out the examples from 
  <a href="http://junit.sourceforge.net/doc/testinfected/testing.htm">Test Infected 
  - Programmers Love Writing Tests</a>.</p>
<p>Once you are comfortable with JUnit, you are ready to start writing tests for 
  the parser. <br>
  We provide you with a utility class - HTMLParserTestCase - with which you can 
  rig up a complex test pretty easily. This class is in the org.htmlparser.tests 
  package in the src.zip.</p>
<p><strong>Writing a testcase with HTMLParserTestCase</strong></p>
<p>HTMLParserTestCase provides you with utility methods to create parser objects 
  quickly and easily for sample html that is being tested. Once you have the parser 
  objects, you have another utility method to parse it and put all the parsed 
  objects into an array of nodes - which is then available to you for assertions.</p>
<p>Lets try writing a simple test - we have a bug report - that the parser throws 
  exception when tags of the type &lt;base ...&gt; are encountered without an 
  href attribute. Base tags can also have target attributes like &lt;base target=&quot;_top&quot;&gt;, 
  but for some reason, the parser doesen't accept this and throws an exception. 
  Before we start to fix the bug, we write a test case to prove that the bug exists. 
</p>
<p>Since there already exists a testcase called HTMLBaseHrefTagTest, we shall 
  add our test to this class. 
  <!-- ======================================================== -->
  <!-- = Java Sourcecode to HTML automatically converted code = -->
  <!-- =   J2H V2.0  2002 by Markus Gebhard  markus@jave.de   = -->
  <!-- =     Further information: http://www.java2html.de     = -->
</p>
<center>
 <table  align="center" border="2" cellpadding="3" cellspacing="0" bgcolor="#FFFBF0">
   <tr>
  <!-- start line numbers -->
   <td align="right" valign="top">
    <code>
     <font color="#808080">
1<br>2<br>3<br>
   </font>
    </code>
   </td>
  <!-- end line numbers -->
  <!-- start source code -->
      <td valign="top"> <code> <font color="#0000c0">public&nbsp;class&nbsp;</font><font color="#000000">HTMLBaseHREFTagTest&nbsp;</font><font color="#0000c0">extends&nbsp;</font><font color="#000000">HTMLParserTestCase&nbsp;</font><font color="#000000">{<br>
&nbsp;&nbsp;</font><font color="#000000">...<br>
}</font></code>
    
   </td>
  </tr>
  <!-- end source code -->
  <!-- start J2H link -->
   <tr>
    <td colspan=2 align=right>
<small>
<a href="http://www.java2html.de" target="_blank">Java2html</a>
</small>
    </td>
   </tr>
  <!-- end J2H link -->
 </table>
</center>
<!-- =       END of automatically generated HTML code       = -->
<!-- ======================================================== -->
<p><br>
  <strong>Note </strong>that all testcases for the parser extend from HTMLParserTestCase. 
</p>
<p>We shall call our method - testNotHREFBaseTag() - for it describes the case 
  when the base tag is not a base href, but something else. It is <strong>very 
  important </strong>to write <strong>intention-revealing code</strong>. This 
  is the reason we can <strong>spend less time on documentation </strong>and <strong>more 
  time on coding</strong>.</p>
<p>Below, we present the code for the method testNotHREFBaseTag() :
  <!-- ======================================================== -->
  <!-- = Java Sourcecode to HTML automatically converted code = -->
  <!-- =   J2H V2.0  2002 by Markus Gebhard  markus@jave.de   = -->
  <!-- =     Further information: http://www.java2html.de     = -->
<center>
 <table  align="center" border="2" cellpadding="3" cellspacing="0" bgcolor="#FFFBF0">
   <tr>
  <!-- start line numbers -->
   <td align="right" valign="top">
    <code>
     <font color="#808080">
1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>
   </font>
    </code>
   </td>
  <!-- end line numbers -->
  <!-- start source code -->
   <td valign="top">
    <code>
<font color="#c0c0c0">&nbsp;&nbsp;</font><font color="#0000c0">public&nbsp;</font><font color="#c00000">void&nbsp;</font><font color="#000000">testNotHREFBaseTag</font><font color="#000000">()&nbsp;</font><font color="#0000c0">throws&nbsp;</font><font color="#000000">HTMLParserException&nbsp;</font><font color="#000000">{<br>
&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#000000">createParser</font><font color="#000000">(</font><font color="#990000">&#34;&lt;base&nbsp;target=\&#34;_top\&#34;&gt;&#34;</font><font color="#000000">)</font><font color="#000000">;<br>
&nbsp;&nbsp;&nbsp;&nbsp;parser.registerScanners</font><font color="#000000">()</font><font color="#000000">;<br>
&nbsp;&nbsp;&nbsp;&nbsp;parseAndAssertNodeCount</font><font color="#000000">(</font><font color="#990000">1</font><font color="#000000">)</font><font color="#000000">;<br>
&nbsp;&nbsp;&nbsp;&nbsp;assertTrue</font><font color="#000000">(</font><font color="#990000">&#34;Should&nbsp;be&nbsp;a&nbsp;base&nbsp;tag&nbsp;but&nbsp;was&nbsp;&#34;</font><font color="#000000">+node</font><font color="#000000">[</font><font color="#990000">0</font><font color="#000000">]</font><font color="#000000">.getClass</font><font color="#000000">()</font><font color="#000000">.getName</font><font color="#000000">()</font><font color="#000000">,node</font><font color="#000000">[</font><font color="#990000">0</font><font color="#000000">]&nbsp;</font><font color="#0000c0">instanceof&nbsp;</font><font color="#000000">HTMLBaseHREFTag</font><font color="#000000">)</font><font color="#000000">;<br>
&nbsp;&nbsp;&nbsp;&nbsp;HTMLBaseHREFTag&nbsp;baseTag&nbsp;=&nbsp;</font><font color="#000000">(</font><font color="#000000">HTMLBaseHREFTag</font><font color="#000000">)</font><font color="#000000">node</font><font color="#000000">[</font><font color="#990000">0</font><font color="#000000">]</font><font color="#000000">;<br>
&nbsp;&nbsp;&nbsp;&nbsp;assertEquals</font><font color="#000000">(</font><font color="#990000">&#34;Base&nbsp;Tag&nbsp;HTML&#34;</font><font color="#000000">,</font><font color="#990000">&#34;&lt;base&nbsp;target=\&#34;_top\&#34;&gt;&#34;</font><font color="#000000">,baseTag.toHTML</font><font color="#000000">())</font><font color="#000000">;<br>
&nbsp;&nbsp;}</font></code>
    
   </td>
  </tr>
  <!-- end source code -->
  <!-- start J2H link -->
   <tr>
    <td colspan=2 align=right>
<small>
<a href="http://www.java2html.de" target="_blank">Java2html</a>
</small>
    </td>
   </tr>
  <!-- end J2H link -->
 </table>
</center>
<!-- =       END of automatically generated HTML code       = -->
<!-- ======================================================== --></p>
<p>In Line 2, we make a call to <em>createParser() </em>- this creates a parser 
  object internally for us, that operates on the data provided in the parameter 
  - the test data. This simulates the situation that the parser encounters a line 
  containing the given test data, that should result in the parser throwing an 
  exception upon parsing - if it is buggy.</p>
<p>In Line 3, we would like to register all the scanners available - with a call 
  to <em>parser.registerScanners()</em>. When writing tests, it is usually a good 
  idea to do this so as to verify that in a practical situation, when all scanners 
  are registered, there are no undesirable side-effects - i.e. even if your scanner 
  works fine individually, it might not when it is in a system of several other 
  scanners.</p>
<p>In Line 4, we ask the parser to pass through this data and collect all the 
  HTML nodes into an array, and also verify that the number of nodes found were 
  what we expected. This is done with a call to <em>parseAndAssertNodeCount()</em>. 
</p>
<p>After a call to this method - we have with us an array called &quot;<strong>node</strong>&quot; 
  - which contains all the parsed objects. We can now take control and do our 
  assertions to see what it contains. Line 5 has an <em>asertTrue()</em>, that 
  verifies that the first node object is indeed a base tag, and if not, it provides 
  the info about the object that was found instead.</p>
<p>Once control passes to line 6, we are sure that what we have is a base href 
  tag - and we can proceed to downcast it to HTMLBaseHREFTag. Once we have our 
  base tag - we can easily test its contents in Line 7.</p>
<p>An important detail to note here is that - your test method must have a <strong>throws 
  clause </strong>- declaring that it throws an <strong>HTMLParserException</strong>. 
  Do not surround your code with a try-catch, unless you are testing that exceptions 
  should be thrown (there are better ways of doing that as well). This is because, 
  JUnit automatically catches any exception thrown and shows the <strong>error 
  </strong> in the test runner.</p>
<p>The above example is from an actual bug-reproduction and fixing session. After 
  the test failed - the bar went red - we had the proof that the bug existed. 
  This was then fixed, and when the bar showed green, it meant that the bug had 
  been eliminated, destryoed, annhilated, whatever.. Death to the bugs!</p>
<p>HTMLParserTestCase also offers an assertStringEquals() method, that does a 
  character-by-character check of two strings and displays valuable mismatch information 
  that is usually not available when you use assertEquals().</p>
<p><strong><a name="communicate"></a>Communicate with testcases</strong></p>
<p>Open-source projects provide a good way of having an expanded testing base. 
  This has proved to be very true in case of the htmlparser project. It is therefore 
  important for us to look at patterns of reporting bugs which enable us to <strong>maximize 
  the communication bandwidth</strong>, and <strong>minmize the involvement time</strong> 
  of developers. </p>
<p>As human beings - language often fails us when we need it most. We do get bug 
  reports like, &quot;The parser barfs at the url .... with this exception ...&quot;. 
  Such a report assumes that someone has the time to try out the url, find the 
  exception, write a test to reproduce the situation, and then fix it. Time is 
  a precious commodity on open-source projects, and bug reports that are not informative 
  enough are often a strain on the developers supporting the project. </p>
<p>We can remedy this with a high-class bug report of the form - &quot;The parser 
  barfs at the url ... with the exception ... It is a problem with the _____ tag 
  , and I wrote a testcase to reproduce this bug. Here is the testcase&quot;. 
</p>
<p>Such bug reports make it a pleasure for any developer to simply take the testcase, 
  run it, find the bug, and fix it. We've often had issues when people reported 
  bugs which we didn't think existed. So we wrote testcases and proved that the 
  code was indeed bug-free (or not).</p>
<p>We encourage users of the parser to get familiar with writing tests for the 
  parser and submit testcases in their bug reports.</p>
</body>
</html>
